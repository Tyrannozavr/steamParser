# –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

## –¶–µ–ª—å —Ç–µ—Å—Ç–æ–≤

–í—ã—è–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç, –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ—Ä—É—Ç–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É —Å–µ—Å—Å–∏—é –ë–î –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

## –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞:** `cannot perform operation: another operation is in progress`

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–µ—Ç–æ–¥—ã `ProxyManager` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `self.db_session` –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ—Ä—É—Ç–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `_db_lock` –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î.

---

## –¢–µ—Å—Ç—ã

### 1. `test_db_concurrency_standalone.py`

–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–µ —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ:
- ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –ø—Ä–æ–±–ª–µ–º—É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—é—Ç, —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –æ—à–∏–±–æ–∫
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞

**–¢–µ—Å—Ç—ã:**
1. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã `_update_redis_cache()`
2. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã `get_active_proxies()`
3. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã `_is_proxy_temporarily_blocked()`
4. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–∫—Å–∏
5. –°–º–µ—à–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
6. –ü–æ–∏—Å–∫ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 2. `test_db_concurrency_code_check.py`

–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –≤ –∫–æ–¥–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞—â–∏—â–µ–Ω—ã –ª–∏ –æ–Ω–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
- ‚úÖ –í—ã—è–≤–ª—è–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
1. –ê–Ω–∞–ª–∏–∑ `proxy_manager.py`
2. –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤ `services/`

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:
```bash
python3 tests/test_db_concurrency_standalone.py
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞:
```bash
python3 tests/test_db_concurrency_code_check.py
```

---

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –∑–∞—â–∏—â–µ–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π

### –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:
- ‚ö†Ô∏è –¢–µ—Å—Ç—ã –≤—ã—è–≤—è—Ç –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ø–æ–∫–∞–∂–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Å—Ç–∞
- üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –±—É–¥—É—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

1. ‚úÖ `_update_redis_cache()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `_db_lock`
2. ‚úÖ `get_active_proxies()` - –∑–∞–º–µ–Ω–µ–Ω–∞ `_lock` –Ω–∞ `_db_lock` –¥–ª—è –ë–î –æ–ø–µ—Ä–∞—Ü–∏–π
3. ‚úÖ `_is_proxy_temporarily_blocked()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `_db_lock`
4. ‚úÖ `_block_proxy_temporarily()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `_db_lock`
5. ‚úÖ `_unblock_proxy()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `_db_lock`
6. ‚úÖ `background_check_proxies()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `_db_lock`
7. ‚úÖ `get_blocked_proxies_info()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `_db_lock`

---

## –í–∞–∂–Ω–æ

–≠—Ç–∏ —Ç–µ—Å—Ç—ã –ø–æ–º–æ–≥–∞—é—Ç:
- üîç –í—ã—è–≤–∏—Ç—å –º–µ—Å—Ç–∞, –≥–¥–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- üõ°Ô∏è –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
