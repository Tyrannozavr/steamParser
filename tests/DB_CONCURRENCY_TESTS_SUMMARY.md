# –°–≤–æ–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

## ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. `test_db_concurrency_standalone.py`
**–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–µ —Ç–µ—Å—Ç—ã** (–Ω–µ —Ç—Ä–µ–±—É—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞)

**–¢–µ—Å—Ç—ã:**
- ‚úÖ –¢–µ—Å—Ç 1: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã `_update_redis_cache()`
- ‚úÖ –¢–µ—Å—Ç 2: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã `get_active_proxies()`
- ‚úÖ –¢–µ—Å—Ç 3: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã `_is_proxy_temporarily_blocked()`
- ‚úÖ –¢–µ—Å—Ç 4: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–∫—Å–∏
- ‚úÖ –¢–µ—Å—Ç 5: –°–º–µ—à–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –¢–µ—Å—Ç 6: –ü–æ–∏—Å–∫ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ 6 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã

---

### 2. `test_db_concurrency_code_check.py`
**–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –ê–Ω–∞–ª–∏–∑ `proxy_manager.py` –Ω–∞ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤ `services/`

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ 19 –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ `proxy_manager.py`
- ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ 26 –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ `monitoring_service.py`
- ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ 7 –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ `results_processor_service.py`

**–í–∞–∂–Ω–æ:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤—ã—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `_set_proxy_last_used_in_db` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `mark_proxy_used`, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –∑–∞—â–∏—â–µ–Ω).

---

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ proxy_manager.py

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å):
1. **–°—Ç—Ä–æ–∫–∞ 512**: `_get_proxy_last_used_from_db()` - –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç
2. **–°—Ç—Ä–æ–∫–∞ 615**: `_set_proxy_last_used_in_db()` - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `mark_proxy_used` (–∑–∞—â–∏—â–µ–Ω)
3. **–°—Ç—Ä–æ–∫–∞ 739**: `_is_proxy_temporarily_blocked()` - —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω–æ)
4. **–°—Ç—Ä–æ–∫–∞ 1187**: `check_all_proxies_parallel()` - –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
5. **–°—Ç—Ä–æ–∫–∞ 1542**: `background_check_proxies()` - —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω–æ)

### –ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–≤–Ω—É—Ç—Ä–∏ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤):
- –°—Ç—Ä–æ–∫–∏ 152, 396, 620, 630, 744, 755, 1142 - –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∏–∑ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é:**
   - `_get_proxy_last_used_from_db()` - –¥–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É, –µ—Å–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
   - `check_all_proxies_parallel()` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–∞ –ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã:**
   - `monitoring_service.py` - 26 –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - `results_processor_service.py` - 7 –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
   - –ó–∞–ø—É—Å–∫–∞—Ç—å `test_db_concurrency_code_check.py` –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
   - –ó–∞–ø—É—Å–∫–∞—Ç—å `test_db_concurrency_standalone.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Ç–µ—Å—Ç–∞–º–∏)

1. ‚úÖ `_update_redis_cache()` - –∑–∞—â–∏—â–µ–Ω–æ `_db_lock`
2. ‚úÖ `get_active_proxies()` - –∑–∞—â–∏—â–µ–Ω–æ `_db_lock` –¥–ª—è –ë–î –æ–ø–µ—Ä–∞—Ü–∏–π
3. ‚úÖ `_is_proxy_temporarily_blocked()` - –∑–∞—â–∏—â–µ–Ω–æ `_db_lock`
4. ‚úÖ `_block_proxy_temporarily()` - –∑–∞—â–∏—â–µ–Ω–æ `_db_lock`
5. ‚úÖ `_unblock_proxy()` - –∑–∞—â–∏—â–µ–Ω–æ `_db_lock`
6. ‚úÖ `background_check_proxies()` - –∑–∞—â–∏—â–µ–Ω–æ `_db_lock`
7. ‚úÖ `get_blocked_proxies_info()` - –∑–∞—â–∏—â–µ–Ω–æ `_db_lock`

---

## üéØ –ò—Ç–æ–≥

**–¢–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—è–≤–ª—è—é—Ç:**
- ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
- ‚úÖ –ú–µ—Å—Ç–∞, –≥–¥–µ –Ω—É–∂–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–¢–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è:**
- üîç –ü–æ–∏—Å–∫–∞ –Ω–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- üõ°Ô∏è –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–π
